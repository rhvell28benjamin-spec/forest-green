<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dojo Strategy Tracker - Forest Green</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #000000;
            min-height: 100vh;
            color: #ffffff;
            padding: 0;
            margin: 0;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 0%, rgba(0, 255, 159, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.98), rgba(5, 5, 5, 0.98));
            backdrop-filter: blur(20px);
            border: none;
            border-radius: 0;
            max-width: 100%;
            width: 100%;
            margin: 0;
            min-height: 100vh;
            box-shadow: none;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 255, 159, 0.08) 0%, transparent 50%);
            animation: pulse 6s ease-in-out infinite;
            pointer-events: none;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 30px;
            background: linear-gradient(135deg, rgba(0, 255, 159, 0.08), rgba(0, 180, 130, 0.05));
            border-bottom: 1px solid rgba(0, 255, 159, 0.2);
            position: relative;
            z-index: 3;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            position: relative;
            transition: all 0.3s ease;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 16px;
            left: 60%;
            right: -40%;
            height: 2px;
            background: rgba(0, 255, 159, 0.2);
            transition: all 0.3s ease;
        }

        .step.active:not(:last-child)::after {
            background: linear-gradient(90deg, #00ff9f, rgba(0, 255, 159, 0.3));
        }

        .step.completed:not(:last-child)::after {
            background: #00ff9f;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0, 255, 159, 0.1);
            border: 2px solid rgba(0, 255, 159, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #00ff9f, #00b368);
            border-color: #00ff9f;
            color: #ffffff;
            box-shadow: 0 0 20px rgba(0, 255, 159, 0.6), 0 4px 15px rgba(0, 255, 159, 0.4);
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: rgba(0, 255, 159, 0.25);
            border-color: #00ff9f;
            color: #00ff9f;
        }

        .step-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .step.active .step-label {
            color: #00ff9f;
            font-weight: 700;
        }

        .step.completed .step-label {
            color: rgba(0, 255, 159, 0.7);
            font-weight: 600;
        }

        .app-header {
            padding: 24px;
            background: linear-gradient(135deg, rgba(0, 255, 159, 0.15), rgba(0, 180, 130, 0.1));
            border-bottom: 1px solid rgba(0, 255, 159, 0.2);
            position: relative;
            z-index: 2;
        }

        .app-title {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff9f, #00d982, #00b368);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .app-subtitle {
            font-size: 12px;
            color: rgba(0, 255, 159, 0.7);
            font-weight: 400;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
            padding: 24px;
            position: relative;
            z-index: 2;
        }

        .screen.active {
            display: block;
        }

        button {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            border-radius: 14px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(0, 255, 159, 0.25), rgba(0, 180, 130, 0.2));
            color: #ffffff;
            border: 1px solid rgba(0, 255, 159, 0.4);
            box-shadow: 
                0 4px 15px rgba(0, 255, 159, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 255, 159, 0.6),
                0 0 40px rgba(0, 255, 159, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: rgba(0, 255, 159, 0.8);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 200, 140, 0.3);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(0, 200, 140, 0.1);
        }

        button.secondary:hover {
            background: rgba(0, 200, 140, 0.1);
            box-shadow: 0 8px 25px rgba(0, 200, 140, 0.4);
            border-color: rgba(0, 200, 140, 0.6);
        }

        button.success {
            background: linear-gradient(135deg, rgba(0, 200, 150, 0.3), rgba(0, 150, 100, 0.25));
            border-color: rgba(0, 200, 150, 0.6);
        }

        button.success:hover {
            box-shadow: 0 8px 25px rgba(0, 200, 150, 0.6), 0 0 40px rgba(0, 200, 150, 0.4);
        }

        button.danger {
            background: linear-gradient(135deg, rgba(255, 70, 100, 0.35), rgba(200, 50, 80, 0.25));
            border-color: rgba(255, 70, 100, 0.6);
        }

        button.danger:hover {
            box-shadow: 0 8px 25px rgba(255, 70, 100, 0.6), 0 0 40px rgba(255, 70, 100, 0.4);
        }

        button.neutral {
            background: linear-gradient(135deg, rgba(0, 200, 140, 0.3), rgba(0, 100, 150, 0.25));
            border-color: rgba(0, 200, 140, 0.6);
        }

        button.neutral:hover {
            box-shadow: 0 8px 25px rgba(0, 200, 140, 0.6), 0 0 40px rgba(0, 200, 140, 0.4);
        }

        h1, h2 {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
        }

        .question {
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        .instructions {
            background: rgba(0, 255, 159, 0.08);
            border-left: 4px solid #00ff9f;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .instructions strong {
            color: #00ff9f;
        }

        .instructions ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="time"] {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: 1px solid rgba(0, 255, 159, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
            color: white;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input::placeholder {
            color: rgba(0, 255, 159, 0.4);
        }

        input:focus {
            outline: none;
            border-color: rgba(0, 255, 159, 0.6);
            background: rgba(0, 255, 159, 0.05);
            box-shadow: 0 0 0 3px rgba(0, 255, 159, 0.15), 0 0 20px rgba(0, 255, 159, 0.3);
        }

        .photo-upload {
            margin: 20px 0;
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .photo-upload label {
            display: block;
            padding: 20px;
            background: rgba(0, 255, 159, 0.05);
            border: 2px dashed rgba(0, 255, 159, 0.4);
            border-radius: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .photo-upload label:hover {
            background: rgba(0, 255, 159, 0.1);
            border-color: rgba(0, 255, 159, 0.7);
            box-shadow: 0 0 30px rgba(0, 255, 159, 0.3);
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .photo-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 159, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 255, 159, 0.08), rgba(0, 180, 130, 0.05));
            border: 1px solid rgba(0, 255, 159, 0.3);
            border-radius: 14px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(0, 255, 159, 0.2) 0%, transparent 70%);
            border-radius: 50%;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff9f, #00d982, #00b368);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 11px;
            color: rgba(0, 255, 159, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .trade-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .trade-item {
            background: rgba(0, 255, 159, 0.05);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 14px;
            border-left: 4px solid #00ff9f;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trade-item:hover {
            background: rgba(0, 255, 159, 0.1);
            transform: translateX(4px);
            box-shadow: 0 4px 20px rgba(0, 255, 159, 0.3);
        }

        .trade-item.expanded {
            background: rgba(0, 255, 159, 0.12);
        }

        .trade-item.winner {
            border-left-color: #00c896;
        }

        .trade-item.loser {
            border-left-color: #ff4664;
        }

        .trade-item.scratch {
            border-left-color: #00d982;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .trade-ticker {
            font-size: 17px;
            font-weight: 700;
            color: #ffffff;
        }

        .trade-outcome {
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 700;
        }

        .trade-outcome.winner {
            background: rgba(0, 200, 150, 0.25);
            color: #00c896;
            border: 1px solid rgba(0, 200, 150, 0.4);
        }

        .trade-outcome.loser {
            background: rgba(255, 70, 100, 0.25);
            color: #ff4664;
            border: 1px solid rgba(255, 70, 100, 0.4);
        }

        .trade-outcome.scratch {
            background: rgba(0, 210, 140, 0.25);
            color: #00d982;
            border: 1px solid rgba(0, 210, 140, 0.4);
        }

        .trade-details {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
        }

        .trade-details-expandable {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 255, 159, 0.2);
        }

        .trade-item.expanded .trade-details-expandable {
            display: block;
        }

        .trade-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .trade-photos img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid rgba(0, 255, 159, 0.3);
        }

        .trade-photos img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 255, 159, 0.5);
        }

        .expand-icon {
            transition: transform 0.3s ease;
            display: inline-block;
            margin-left: 8px;
            font-size: 12px;
        }

        .trade-item.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .modal.active {
            display: flex;
        }

        .modal img {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .back-button {
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
            padding: 12px 16px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-steps" id="progress-steps">
            <div class="step" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Confidence</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Setup</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Entry</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Outcome</div>
            </div>
        </div>

        <div class="app-header">
            <div class="app-title">Dojo Strategy Tracker</div>
            <div class="app-subtitle" id="header-subtitle">Forest Green Edition</div>
        </div>

        <!-- Screen 0: Confidence Check - Page 1 -->
        <div class="screen active" id="screen-confidence-1">
            <h2>Confidence Check - Step 1/3</h2>
            <div class="question">
                Is this the first substantial move of this stock today?
            </div>
            <button onclick="answerSubstantialMove(true)">
                <span style="font-size: 18px; margin-right: 8px;">‚úÖ</span>
                Yes - Clear, Obvious 1st Move
            </button>
            <button class="secondary" onclick="answerSubstantialMove(false)">
                <span style="font-size: 18px; margin-right: 8px;">‚ö†Ô∏è</span>
                No - Probably Not Gonna Go Well
            </button>
            <button class="secondary" onclick="showStats()" style="margin-top: 30px;">
                <span style="font-size: 18px; margin-right: 8px;">üìä</span>
                View Stats & History
            </button>
            <div style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.5); font-size: 14px;">
                Current Confidence: <span id="confidence-display-1" style="color: #00ff9f; font-weight: 700;">100%</span>
            </div>
        </div>

        <!-- Screen 0B: Confidence Check - Page 2 -->
        <div class="screen" id="screen-confidence-2">
            <button class="back-button secondary" onclick="goBackConfidence(1)">‚Üê Back</button>
            <h2>Confidence Check - Step 2/3</h2>
            <div class="question">
                Did this move happen right after yesterday's session ended?
            </div>
            <button onclick="answerTimingAfterClose('right-away')">
                <span style="font-size: 18px; margin-right: 8px;">‚ö°</span>
                Happened Right Away
            </button>
            <button onclick="answerTimingAfterClose('less-than-10')">
                <span style="font-size: 18px; margin-right: 8px;">üìä</span>
                Less Than 10 Candles
            </button>
            <button class="secondary" onclick="answerTimingAfterClose('more-than-10')">
                <span style="font-size: 18px; margin-right: 8px;">‚è∞</span>
                More Than 10 Candles
            </button>
            <div style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.5); font-size: 14px;">
                Current Confidence: <span id="confidence-display-2" style="color: #00ff9f; font-weight: 700;">100%</span>
            </div>
        </div>

        <!-- Screen 0C: Confidence Check - Page 3 -->
        <div class="screen" id="screen-confidence-3">
            <button class="back-button secondary" onclick="goBackConfidence(2)">‚Üê Back</button>
            <h2>Confidence Check - Step 3/3</h2>
            <div class="question">
                Was it in the green session?
            </div>
            <button onclick="answerGreenSession(true)">
                <span style="font-size: 18px; margin-right: 8px;">üü¢</span>
                Yes - Green Session
            </button>
            <button class="secondary" onclick="answerGreenSession(false)">
                <span style="font-size: 18px; margin-right: 8px;">üî¥</span>
                No - Not Green Session
            </button>
            <div style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.5); font-size: 14px;">
                Current Confidence: <span id="confidence-display-3" style="color: #00ff9f; font-weight: 700;">100%</span>
            </div>
        </div>

        <!-- Screen 0D: Skip Trade -->
        <div class="screen" id="screen-skip">
            <h2>‚ö†Ô∏è Skip This Trade</h2>
            <div class="instructions" style="border-left-color: #ffa726;">
                <strong>Confidence Too Low</strong>
                <p style="margin-top: 8px;">Your confidence is below 70%. It's better to wait for a higher-probability setup.</p>
                <p style="margin-top: 10px;">Only trade when you're at least 70% confident in the move.</p>
            </div>
            <div style="text-align: center; margin: 20px 0; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                <div style="font-size: 32px; font-weight: 800; color: #ff6b6b;">
                    <span id="final-confidence-display">0%</span>
                </div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 4px;">FINAL CONFIDENCE</div>
            </div>
            <button onclick="resetConfidence()">Back to Start</button>
        </div>

        <div class="screen" id="screen-1">
            <button class="back-button secondary" onclick="goToScreen('screen-confidence-3')">‚Üê Back</button>
            <h2>Setup Selection</h2>
            <div class="question">
                Did you find the first pullback candle?<br>
                <small style="font-size: 13px; color: rgba(255,255,255,0.5);">(First candle that failed to make a new high)</small>
            </div>
            <button onclick="startSetup('pullback')">
                <span style="font-size: 18px; margin-right: 8px;">üìä</span>
                Pullback
            </button>
            <button onclick="startSetup('doji')">
                <span style="font-size: 18px; margin-right: 8px;">üéØ</span>
                Doji
            </button>
            <div style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.5); font-size: 14px;">
                Current Confidence: <span id="confidence-display-setup" style="color: #00ff9f; font-weight: 700;">100%</span>
            </div>
        </div>

        <div class="screen" id="screen-pullback-1">
            <button class="back-button secondary" onclick="goToScreen('screen-1')">‚Üê Back</button>
            <h2>Pullback Setup</h2>
            <div class="instructions">
                <strong>Mark Your Pullback:</strong>
                <ul>
                    <li><strong>Entry Line:</strong> High of Candle #1</li>
                    <li><strong>Stop Loss:</strong> Low of Candle #1</li>
                </ul>
                <br>
                <svg width="100%" height="150" viewBox="0 0 300 150" style="background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0;">
                    <rect x="20" y="100" width="8" height="35" fill="#00c896" opacity="0.3"/>
                    <rect x="22" y="105" width="4" height="25" fill="#00c896"/>
                    <rect x="40" y="75" width="8" height="35" fill="#00c896" opacity="0.3"/>
                    <rect x="42" y="80" width="4" height="25" fill="#00c896"/>
                    <rect x="60" y="50" width="8" height="35" fill="#00c896" opacity="0.3"/>
                    <rect x="62" y="55" width="4" height="25" fill="#00c896"/>
                    <rect x="80" y="60" width="8" height="35" fill="#ff4664" opacity="0.3"/>
                    <rect x="82" y="65" width="4" height="25" fill="#ff4664"/>
                    <rect x="100" y="70" width="8" height="20" fill="#666" opacity="0.3"/>
                    <rect x="102" y="75" width="4" height="10" fill="#666"/>
                    <rect x="120" y="55" width="8" height="25" fill="#00c896" opacity="0.3"/>
                    <rect x="122" y="58" width="4" height="20" fill="#00c896"/>
                    <line x1="75" y1="60" x2="280" y2="60" stroke="#00ff9f" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="200" y="55" fill="#00ff9f" font-size="10">Entry Line (High of #1)</text>
                    <line x1="75" y1="95" x2="280" y2="95" stroke="#ff4664" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="200" y="110" fill="#ff4664" font-size="10">Stop (Low of #1)</text>
                    <text x="42" y="135" fill="#fff" font-size="10">Move</text>
                    <text x="82" y="135" fill="#ff4664" font-size="10">#1</text>
                    <text x="102" y="135" fill="#666" font-size="10">#2</text>
                    <text x="122" y="135" fill="#00c896" font-size="10">#3</text>
                </svg>
                <strong>Confirmation Rule:</strong>
                <ul>
                    <li>2 more candles can form (Candle #2 and #3)</li>
                    <li>Entry triggers when either candle <strong>closes above</strong> the entry line on 15-second chart</li>
                </ul>
            </div>
            <div class="question">Did you get confirmation?</div>
            <button onclick="enterTrade('pullback')">Pullback Confirmation Confirmed</button>
            <button class="secondary" onclick="startSetup('doji')">Look for Doji Near 20 EMA</button>
        </div>

        <div class="screen" id="screen-doji-1">
            <button class="back-button secondary" onclick="goToScreen('screen-1')">‚Üê Back</button>
            <h2>Doji Setup</h2>
            <div class="instructions">
                <strong>Mark Your Doji:</strong>
                <ul>
                    <li><strong>Entry Line:</strong> High of doji body</li>
                    <li><strong>Stop Loss:</strong> Low of doji wick</li>
                    <li>Doji should be at or near the 20 EMA</li>
                </ul>
                <svg width="100%" height="150" viewBox="0 0 300 150" style="background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0;">
                    <line x1="10" y1="80" x2="290" y2="80" stroke="#ffa726" stroke-width="2"/>
                    <text x="10" y="75" fill="#ffa726" font-size="10">20 EMA</text>
                    <rect x="40" y="105" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="42" y="110" width="4" height="20" fill="#00c896"/>
                    <rect x="60" y="85" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="62" y="90" width="4" height="20" fill="#00c896"/>
                    <rect x="80" y="65" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="82" y="70" width="4" height="20" fill="#00c896"/>
                    <line x1="104" y1="65" x2="104" y2="95" stroke="#00ff9f" stroke-width="1"/>
                    <rect x="100" y="77" width="8" height="6" fill="#00ff9f"/>
                    <rect x="120" y="60" width="8" height="25" fill="#00c896" opacity="0.3"/>
                    <rect x="122" y="63" width="4" height="20" fill="#00c896"/>
                    <line x1="95" y1="77" x2="280" y2="77" stroke="#00ff9f" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="180" y="72" fill="#00ff9f" font-size="10">Entry (High of Body)</text>
                    <line x1="95" y1="95" x2="280" y2="95" stroke="#ff4664" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="180" y="110" fill="#ff4664" font-size="10">Stop (Low of Wick)</text>
                    <text x="62" y="135" fill="#fff" font-size="10">Move</text>
                    <text x="95" y="135" fill="#00ff9f" font-size="10">Doji</text>
                    <text x="118" y="135" fill="#00c896" font-size="10">Confirm</text>
                </svg>
            </div>
            <div class="question">Is there a cleaner doji closer to the 20 EMA?</div>
            <button onclick="goToScreen('screen-doji-better')">Look for Better Doji</button>
            <button onclick="enterTrade('doji')">Found Confirmation</button>
        </div>

        <div class="screen" id="screen-doji-better">
            <button class="back-button secondary" onclick="goToScreen('screen-1')">‚Üê Back</button>
            <h2>Doji Setup</h2>
            <div class="instructions">
                <strong>Mark Your Doji:</strong>
                <ul>
                    <li><strong>Entry Line:</strong> High of doji body</li>
                    <li><strong>Stop Loss:</strong> Low of doji wick</li>
                    <li>Doji should be at or near the 20 EMA</li>
                </ul>
                <svg width="100%" height="150" viewBox="0 0 350 150" style="background: rgba(0,0,0,0.3); border-radius: 8px; margin: 10px 0;">
                    <line x1="10" y1="85" x2="340" y2="85" stroke="#ffa726" stroke-width="2"/>
                    <text x="10" y="80" fill="#ffa726" font-size="10">20 EMA</text>
                    <rect x="40" y="110" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="42" y="115" width="4" height="20" fill="#00c896"/>
                    <rect x="60" y="90" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="62" y="95" width="4" height="20" fill="#00c896"/>
                    <rect x="80" y="70" width="8" height="30" fill="#00c896" opacity="0.3"/>
                    <rect x="82" y="75" width="4" height="20" fill="#00c896"/>
                    <line x1="104" y1="60" x2="104" y2="85" stroke="#666" stroke-width="1" opacity="0.5"/>
                    <rect x="100" y="70" width="8" height="6" fill="#666" opacity="0.5"/>
                    <text x="92" y="55" fill="#666" font-size="9">First doji</text>
                    <rect x="120" y="75" width="8" height="25" fill="#ff4664" opacity="0.3"/>
                    <rect x="122" y="80" width="4" height="15" fill="#ff4664"/>
                    <line x1="144" y1="70" x2="144" y2="100" stroke="#00ff9f" stroke-width="2"/>
                    <rect x="140" y="82" width="8" height="8" fill="#00ff9f"/>
                    <circle cx="144" cy="86" r="20" fill="none" stroke="#00ff9f" stroke-width="1" stroke-dasharray="2,2"/>
                    <text x="128" y="115" fill="#00ff9f" font-size="9" font-weight="bold">Better doji!</text>
                    <rect x="160" y="65" width="8" height="25" fill="#00c896" opacity="0.3"/>
                    <rect x="162" y="68" width="4" height="20" fill="#00c896"/>
                    <line x1="135" y1="82" x2="320" y2="82" stroke="#00ff9f" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="230" y="77" fill="#00ff9f" font-size="10">Entry (Better Doji)</text>
                    <line x1="135" y1="100" x2="320" y2="100" stroke="#ff4664" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="230" y="115" fill="#ff4664" font-size="10">Stop</text>
                    <text x="62" y="140" fill="#fff" font-size="9">Move</text>
                    <text x="95" y="140" fill="#666" font-size="9">Doji 1</text>
                    <text x="118" y="140" fill="#ff4664" font-size="9">No conf.</text>
                    <text x="135" y="140" fill="#00ff9f" font-size="9">Doji 2</text>
                    <text x="158" y="140" fill="#00c896" font-size="9">Confirm</text>
                </svg>
                <p style="font-size: 13px; margin-top: 10px; color: rgba(255,255,255,0.7);">The second doji is closer to the 20 EMA and provides a better risk/reward setup.</p>
            </div>
            <div class="question">Is there a cleaner doji closer to the 20 EMA?</div>
            <button onclick="goToScreen('screen-doji-better')">Look for Better Doji</button>
            <button onclick="enterTrade('doji')">Found Confirmation</button>
        </div>

        <div class="screen" id="screen-in-trade">
            <h2>Trade Active</h2>
            <div class="question">What happened?</div>
            <button class="success" onclick="goToScreen('screen-outcome-2r')">
                <span style="font-size: 18px; margin-right: 8px;">‚úÖ</span>
                Hit +2R Target
            </button>
            <button onclick="goToScreen('screen-1r-protection')">
                <span style="font-size: 18px; margin-right: 8px;">‚ö°</span>
                Hit 1R First
            </button>
            <button class="danger" onclick="goToScreen('screen-outcome-loss')">
                <span style="font-size: 18px; margin-right: 8px;">‚ùå</span>
                Hit -1R Stop
            </button>
            <div class="instructions" style="margin-top: 20px; border-left-color: #ffa726;">
                <strong>Note:</strong> If price returns to entry but hasn't hit 1R yet, stay in the trade. Only exit at +2R, 1R protection, or -1R.
            </div>
        </div>

        <div class="screen" id="screen-1r-protection">
            <h2>1R Protection Active</h2>
            <div class="instructions" style="border-left-color: #00c896;">
                <strong>Break-Even Locked In!</strong>
                <p style="margin-top: 8px;">You've hit 1R. Minimum outcome is now break-even.</p>
            </div>
            <div class="question">What happened next?</div>
            <button class="success" onclick="goToScreen('screen-outcome-2r')">
                <span style="font-size: 18px; margin-right: 8px;">‚úÖ</span>
                Hit +2R Target
            </button>
            <button class="neutral" onclick="goToScreen('screen-outcome-scratch')">
                <span style="font-size: 18px; margin-right: 8px;">‚ÜîÔ∏è</span>
                Came Back to Entry
            </button>
        </div>

        <div class="screen" id="screen-outcome-2r">
            <h2>üéØ Winner!</h2>
            <div class="instructions" style="border-left-color: #00c896;">
                <strong>+2R Profit</strong>
                <p style="margin-top: 8px;">Congratulations on hitting your target!</p>
            </div>
            <button onclick="logTrade(2)">Log Trade Details</button>
        </div>

        <div class="screen" id="screen-outcome-scratch">
            <h2>‚ÜîÔ∏è Scratch Trade</h2>
            <div class="instructions" style="border-left-color: #ffa726;">
                <strong>Break-Even (0R)</strong>
                <p style="margin-top: 8px;">Hit 1R first, then came back to entry.</p>
            </div>
            <button onclick="logTrade(0)">Log Trade Details</button>
        </div>

        <div class="screen" id="screen-outcome-loss">
            <h2>‚ùå Loss</h2>
            <div class="instructions" style="border-left-color: #ff4664;">
                <strong>-1R Loss</strong>
                <p style="margin-top: 8px;">Stop loss hit. Review and learn.</p>
            </div>
            <button onclick="logTrade(-1)">Log Trade Details</button>
        </div>

        <div class="screen" id="screen-log-trade">
            <h2>Log Trade Details</h2>
            <div class="instructions">
                <strong>Setup:</strong> <span id="log-setup-type"></span><br>
                <strong>Outcome:</strong> <span id="log-outcome"></span><br>
                <strong>Confidence:</strong> <span id="log-confidence"></span>
            </div>
            
            <input type="text" id="ticker-input" placeholder="Ticker Symbol (e.g., AAPL)" required>
            <input type="time" id="time-input" required>
            
            <div class="photo-upload">
                <label for="photo-input">
                    üì∑ Add Chart Photos<br>
                    <small style="font-size: 12px; color: rgba(255,255,255,0.5);">(Tap to select multiple)</small>
                </label>
                <input type="file" id="photo-input" accept="image/*" multiple>
                <div class="photo-preview" id="photo-preview"></div>
            </div>

            <button class="success" onclick="saveTrade()">Save Trade</button>
            <button class="secondary" onclick="goToScreen('screen-confidence')">Cancel</button>
        </div>

        <div class="screen" id="screen-stats">
            <button class="back-button secondary" onclick="goToScreen('screen-confidence-1')">‚Üê Back to Strategy</button>
            <h2>Performance Stats</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-r">0R</div>
                    <div class="stat-label">Total R</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-trades">0 / 100</div>
                    <div class="stat-label">Total Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-winners">0</div>
                    <div class="stat-label">Winners (+2R)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-scratches">0</div>
                    <div class="stat-label">Scratches (0R)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-losers">0</div>
                    <div class="stat-label">Losers (-1R)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-winrate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
            </div>

            <h2 style="margin-top: 30px;">Trade History</h2>
            <div class="trade-list" id="trade-list">
                <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 14px;">No trades logged yet</p>
            </div>

            <button class="danger" onclick="clearAllData()" style="margin-top: 20px;">Clear All Data</button>
        </div>
    </div>

    <div class="modal" id="image-modal">
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <img id="modal-image" src="" alt="Trade Chart">
    </div>

    <script>
        let currentSetup = '';
        let currentOutcome = 0;
        let currentConfidence = 0;
        let selectedPhotos = [];
        let trades = JSON.parse(localStorage.getItem('dojoTrades')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            updateProgressSteps('screen-confidence-1');
            
            const now = new Date();
            const timeString = now.toTimeString().slice(0, 5);
            document.getElementById('time-input').value = timeString;

            document.getElementById('photo-input').addEventListener('change', handlePhotoSelect);

            updateHeaderTime();
            setInterval(updateHeaderTime, 60000);
        });

        function updateHeaderTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('header-subtitle').textContent = `${dateStr} ‚Ä¢ ${timeStr}`;
        }

        function goToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            updateProgressSteps(screenId);
        }

        function updateProgressSteps(screenId) {
            let activeStep = 1;
            
            if (screenId === 'screen-confidence-1' || screenId === 'screen-confidence-2' || 
                screenId === 'screen-confidence-3' || screenId === 'screen-skip') {
                activeStep = 1;
            }
            else if (screenId === 'screen-1' || screenId === 'screen-pullback-1' || 
                     screenId === 'screen-doji-1' || screenId === 'screen-doji-better') {
                activeStep = 2;
            }
            else if (screenId === 'screen-in-trade' || screenId === 'screen-1r-protection') {
                activeStep = 3;
            }
            else if (screenId === 'screen-outcome-2r' || screenId === 'screen-outcome-scratch' || 
                     screenId === 'screen-outcome-loss' || screenId === 'screen-log-trade') {
                activeStep = 4;
            }
            else if (screenId === 'screen-stats') {
                document.getElementById('progress-steps').style.display = 'none';
                return;
            }

            document.getElementById('progress-steps').style.display = 'flex';

            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNum === activeStep) {
                    step.classList.add('active');
                } else if (stepNum < activeStep) {
                    step.classList.add('completed');
                }
            });
        }

        // New confidence system functions
        function answerSubstantialMove(isSubstantial) {
            if (isSubstantial) {
                currentConfidence = 100;
            } else {
                currentConfidence = 60; // 100 - 40 = 60
            }
            updateConfidenceDisplay(2);
            goToScreen('screen-confidence-2');
        }

        function answerTimingAfterClose(timing) {
            if (timing === 'right-away') {
                currentConfidence = Math.min(100, currentConfidence + 20);
            } else if (timing === 'less-than-10') {
                currentConfidence = Math.min(100, currentConfidence + 10);
            } else if (timing === 'more-than-10') {
                currentConfidence = currentConfidence - 10;
            }
            updateConfidenceDisplay(3);
            goToScreen('screen-confidence-3');
        }

        function answerGreenSession(isGreen) {
            if (isGreen) {
                currentConfidence = Math.min(100, currentConfidence + 10);
            } else {
                currentConfidence = currentConfidence - 30;
            }
            
            // Check if confidence is below threshold
            if (currentConfidence < 70) {
                document.getElementById('final-confidence-display').textContent = currentConfidence + '%';
                goToScreen('screen-skip');
            } else {
                // Update the setup page confidence display
                document.getElementById('confidence-display-setup').textContent = currentConfidence + '%';
                goToScreen('screen-1');
            }
        }

        function updateConfidenceDisplay(page) {
            const displayId = 'confidence-display-' + page;
            const element = document.getElementById(displayId);
            if (element) {
                element.textContent = currentConfidence + '%';
            }
        }

        function goBackConfidence(toPage) {
            if (toPage === 1) {
                currentConfidence = 100;
                goToScreen('screen-confidence-1');
            } else if (toPage === 2) {
                // Recalculate from page 1's answer
                goToScreen('screen-confidence-2');
            }
        }

        function resetConfidence() {
            currentConfidence = 100;
            document.getElementById('confidence-display-1').textContent = '100%';
            document.getElementById('confidence-display-2').textContent = '100%';
            document.getElementById('confidence-display-3').textContent = '100%';
            goToScreen('screen-confidence-1');
        }

        function startSetup(setup) {
            currentSetup = setup;
            if (setup === 'pullback') {
                goToScreen('screen-pullback-1');
            } else {
                goToScreen('screen-doji-1');
            }
        }

        function enterTrade(setup) {
            currentSetup = setup;
            goToScreen('screen-in-trade');
        }

        function logTrade(outcome) {
            currentOutcome = outcome;
            document.getElementById('log-setup-type').textContent = currentSetup.toUpperCase();
            
            let outcomeText = '';
            if (outcome === 2) outcomeText = '+2R (Winner)';
            else if (outcome === 0) outcomeText = '0R (Scratch)';
            else if (outcome === -1) outcomeText = '-1R (Loss)';
            
            document.getElementById('log-outcome').textContent = outcomeText;
            document.getElementById('log-confidence').textContent = currentConfidence + '%';
            
            selectedPhotos = [];
            document.getElementById('photo-preview').innerHTML = '';
            document.getElementById('ticker-input').value = '';
            
            const now = new Date();
            const timeString = now.toTimeString().slice(0, 5);
            document.getElementById('time-input').value = timeString;
            
            goToScreen('screen-log-trade');
        }

        function handlePhotoSelect(e) {
            const files = Array.from(e.target.files);
            selectedPhotos = [];
            
            const preview = document.getElementById('photo-preview');
            preview.innerHTML = '';
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    selectedPhotos.push(event.target.result);
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        function saveTrade() {
            const ticker = document.getElementById('ticker-input').value.trim().toUpperCase();
            const time = document.getElementById('time-input').value;
            
            if (!ticker) {
                alert('Please enter a ticker symbol');
                return;
            }
            
            if (!time) {
                alert('Please enter the time');
                return;
            }
            
            const trade = {
                id: Date.now(),
                setup: currentSetup,
                outcome: currentOutcome,
                confidence: currentConfidence,
                ticker: ticker,
                time: time,
                date: new Date().toLocaleDateString(),
                photos: selectedPhotos
            };
            
            trades.unshift(trade);
            localStorage.setItem('dojoTrades', JSON.stringify(trades));
            
            updateStats();
            
            selectedPhotos = [];
            currentSetup = '';
            currentOutcome = 0;
            
            // Reset confidence system
            resetConfidence();
        }

        function updateStats() {
            const totalR = trades.reduce((sum, t) => sum + t.outcome, 0);
            const totalTrades = trades.length;
            const winners = trades.filter(t => t.outcome === 2).length;
            const scratches = trades.filter(t => t.outcome === 0).length;
            const losers = trades.filter(t => t.outcome === -1).length;
            const winRate = totalTrades > 0 ? ((winners / totalTrades) * 100).toFixed(1) : 0;
            
            document.getElementById('stat-total-r').textContent = (totalR > 0 ? '+' : '') + totalR + 'R';
            document.getElementById('stat-total-trades').textContent = totalTrades + ' / 100';
            document.getElementById('stat-winners').textContent = winners;
            document.getElementById('stat-scratches').textContent = scratches;
            document.getElementById('stat-losers').textContent = losers;
            document.getElementById('stat-winrate').textContent = winRate + '%';
            
            const tradeList = document.getElementById('trade-list');
            if (trades.length === 0) {
                tradeList.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 14px;">No trades logged yet</p>';
            } else {
                tradeList.innerHTML = trades.map(trade => {
                    let outcomeClass = '';
                    let outcomeLabel = '';
                    
                    if (trade.outcome === 2) {
                        outcomeClass = 'winner';
                        outcomeLabel = '+2R';
                    } else if (trade.outcome === 0) {
                        outcomeClass = 'scratch';
                        outcomeLabel = '0R';
                    } else {
                        outcomeClass = 'loser';
                        outcomeLabel = '-1R';
                    }
                    
                    const photosHtml = trade.photos && trade.photos.length > 0 
                        ? `<div class="trade-photos">
                            ${trade.photos.map(photo => `<img src="${photo}" onclick="event.stopPropagation(); openModal('${photo}')" alt="Chart">`).join('')}
                           </div>`
                        : '<p style="color: rgba(255,255,255,0.4); font-size: 12px; margin-top: 8px;">No photos</p>';
                    
                    return `
                        <div class="trade-item ${outcomeClass}" onclick="toggleTradeExpand(${trade.id})">
                            <div class="trade-header">
                                <span class="trade-ticker">${trade.ticker}</span>
                                <div>
                                    <span class="trade-outcome ${outcomeClass}">${outcomeLabel}</span>
                                    <span class="expand-icon">‚ñº</span>
                                </div>
                            </div>
                            <div class="trade-details">
                                <strong>${trade.setup.toUpperCase()}</strong> ‚Ä¢ ${trade.confidence || 'N/A'}% confident ‚Ä¢ ${trade.date} ‚Ä¢ ${trade.time}
                            </div>
                            <div class="trade-details-expandable" id="trade-${trade.id}">
                                <div style="margin-bottom: 15px;">
                                    <strong style="font-size: 13px; color: rgba(255,255,255,0.8);">Chart Photos:</strong>
                                    ${photosHtml}
                                </div>
                                <button onclick="event.stopPropagation(); editTrade(${trade.id})" style="width: 100%; padding: 10px; margin-top: 10px;" class="secondary">Edit Trade</button>
                                <button onclick="event.stopPropagation(); deleteTrade(${trade.id})" style="width: 100%; padding: 10px; margin-top: 5px;" class="danger">Delete Trade</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function showStats() {
            updateStats();
            goToScreen('screen-stats');
        }

        function toggleTradeExpand(tradeId) {
            const tradeItems = document.querySelectorAll('.trade-item');
            tradeItems.forEach(item => {
                if (item.onclick && item.onclick.toString().includes(tradeId)) {
                    item.classList.toggle('expanded');
                }
            });
        }

        function editTrade(tradeId) {
            const trade = trades.find(t => t.id === tradeId);
            if (!trade) return;

            const newTicker = prompt('Edit Ticker:', trade.ticker);
            if (newTicker && newTicker.trim()) {
                trade.ticker = newTicker.trim().toUpperCase();
            }

            const newTime = prompt('Edit Time (HH:MM):', trade.time);
            if (newTime && newTime.match(/^\d{2}:\d{2}$/)) {
                trade.time = newTime;
            }

            const newOutcome = prompt('Edit Outcome (2 for +2R, 0 for scratch, -1 for loss):', trade.outcome);
            if (newOutcome !== null && ['-1', '0', '2'].includes(newOutcome)) {
                trade.outcome = parseInt(newOutcome);
            }

            localStorage.setItem('dojoTrades', JSON.stringify(trades));
            updateStats();
        }

        function deleteTrade(tradeId) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== tradeId);
                localStorage.setItem('dojoTrades', JSON.stringify(trades));
                updateStats();
            }
        }

        function openModal(photoSrc) {
            document.getElementById('modal-image').src = photoSrc;
            document.getElementById('image-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('image-modal').classList.remove('active');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all trade data? This cannot be undone.')) {
                trades = [];
                localStorage.removeItem('dojoTrades');
                updateStats();
            }
        }
    </script>
</body>
</html>